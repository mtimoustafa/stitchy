<div class="flex justify-between">
  <div class="inline-block space-x-6">
    <RouterLink to="/">
      Back
    </RouterLink>

    <h2 class="text-xl sm:text-2xl font-bold inline-block">{project.name}</h2>

    <RouterLink to="/projects/{projectId}/edit">
      Edit
    </RouterLink>

    {#if project.link}
      <a
        class="px-6 py-3 rounded-lg bg-s-red"
        href="{project.link}"
        target="_blank"
        rel="noreferrer noopener"
      >
        Link
      </a>
    {/if}
  </div>

  <Button on:click={() => deleteProject(project.id)}>
    Delete
  </Button>
</div>

<h3 class="text-md sm:text-lg font-bold">Steps</h3>
<ol class="list-decimal text-sky-50 ml-4">
  {#each project.steps as step, index}
    <li>
      {#if project.currentStep > index}
        âœ…
      {/if}
      {step.description}
    </li>
  {/each}
</ol>

<h3 class="text-md sm:text-lg font-bold">Current Step</h3>

{#if project.currentStep >= project.steps.length}
  <p class="text-sky-50">Done!</p>
{:else}
  <p class="text-sky-50">{project.steps[project.currentStep].description}</p>
{/if}

<Button
  on:click={previousStep}
>
  Previous
</Button>
<Button
  on:click={nextStep}
>
  Done
</Button>

<script>
  import { navigate } from 'svelte-navigator'
  import { projects } from '../store/stores.js'
  import Button from './shared/Button.svelte'
  import RouterLink from './shared/RouterLink.svelte'

  export let projectId
  let project

  project = $projects.find(p => p.id === projectId)
  if (project === undefined) {
    project = { steps: [], currentStep: 0 } // For clean teardown
    navigate('/')
  }

  function previousStep() {
    $projects.map(p => {
      if (p.id === project.id) {
        project.currentStep = p.currentStep <= 0 ? 0 : p.currentStep - 1
        p.currentStep = project.currentStep
      }
    })
    localStorage.setItem('projects', JSON.stringify($projects))
  }

  function nextStep() {
    $projects.map(p => {
      if (p.id === project.id) {
        project.currentStep = p.currentStep >= p.steps.length ? p.steps.length : p.currentStep + 1
        p.currentStep = project.currentStep
      }
    })
    localStorage.setItem('projects', JSON.stringify($projects))
  }

  function deleteProject(id) {
    if (window.confirm(`Are you sure you want to delete ${project.name}?`)) {
      $projects = $projects.filter(p => p.id !== id)
      localStorage.setItem('projects', JSON.stringify($projects))
      navigate('/')
    }
  }
</script>
